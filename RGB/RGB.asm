#INCLUDE "P16F887.INC"

	__CONFIG _CONFIG1, (_CP_OFF & _WDT_OFF & _PWRTE_ON & _XT_OSC & _LVP_OFF)
	__CONFIG _CONFIG2, _BOR21V
PDel0 EQU 0X23  ; defino reg GPR para rutina de tiempo
PDel1 EQU 0X24  ; defino reg GPR para rutina de tiempo
PDel2 EQU 0X25  ; defino reg GPR para rutina de tiempo
REGCONTADOR EQU 0X26
REGC EQU 0X27
REGD EQU 0X28
REGU EQU 0X29
REG1 EQU 0X2A
REG2 EQU 0X2B
REG3 EQU 0X2C
REG4 EQU 0X2D
REG11 EQU 0X20
REG22 EQU 0X21
REG33 EQU 0X22
REG44 EQU 0X2E

ORG 0X00
GOTO INICIO

TABLA1
	ADDWF PCL,F
	RETLW B'00000001'
	RETLW B'00000010'
	RETLW B'00000100'
	RETLW B'00000010'
	RETLW B'00000010'
	RETLW B'00000001'
	RETLW B'00000100'
	RETLW B'00000001'
	RETLW B'00000100'
	RETLW B'00000010'
	RETLW B'00000001'
	RETLW B'00000001'
TABLA2
	ADDWF PCL,F
	RETLW B'00000100'
	RETLW B'00000001'
	RETLW B'00000010'
	RETLW B'00000001'
	RETLW B'00000100'
	RETLW B'00000010'
	RETLW B'00000100'
	RETLW B'00000001'
	RETLW B'00000010'
	RETLW B'00000010'
	RETLW B'00000100'
	RETLW B'00000001'
TABLA3
	ADDWF PCL,F
	RETLW B'00000001'
	RETLW B'00000010'
	RETLW B'00000100'
	RETLW B'00000010'
	RETLW B'00000010'
	RETLW B'00000001'
	RETLW B'00000100'
	RETLW B'00000001'
	RETLW B'00000100'
	RETLW B'00000010'
	RETLW B'00000001'
	RETLW B'00000001'
TABLA4
	ADDWF PCL,F
	RETLW B'00000010'
	RETLW B'00000001'
	RETLW B'00000100'
	RETLW B'00000010'
	RETLW B'00000100'
	RETLW B'00000001'
	RETLW B'00000010'
	RETLW B'00000001'
	RETLW B'00000100'
	RETLW B'00000100'
	RETLW B'00000010'
	RETLW B'00000001'

INICIO
	BANKSEL ANSEL
	CLRF ANSEL
	CLRF ANSELH

	BANKSEL PORTB
	CLRF PORTB
	CLRF PORTE

	BANKSEL TRISB
	CLRF TRISB
	BSF TRISB,0
	BSF TRISB,1
	BSF TRISB,2
	CLRF TRISE
	BANKSEL PORTA
	CLRF REGU
	CLRF REGD
	CLRF REGC
	CLRF REGCONTADOR
	CLRF REG1
	CLRF REG2
	CLRF REG3
	CLRF REG4
	CLRF REG11
	CLRF REG22
	CLRF REG33
	CLRF REG44

BUCLE
	INCF REGCONTADOR,1
	BTFSC PORTB,0
	GOTO DESCOMPONER1
	BTFSC PORTB,1
	GOTO DESCOMPONER2
	BTFSC PORTB,2
	GOTO DESCOMPONER3
	GOTO BUCLE
DESCOMPONER1
	BTFSC PORTB,0
	GOTO $-.1
	GOTO CENTENA
DESCOMPONER2
	BTFSC PORTB,1
	GOTO $-.1
	GOTO CENTENA
DESCOMPONER3
	BTFSC PORTB,2
	GOTO $-.1
	GOTO CENTENA
CENTENA
	MOVLW .100
	SUBWF REGCONTADOR,F
	BTFSC STATUS,C
	GOTO $+.3
	ADDWF REGCONTADOR,F
	GOTO DECENA
	INCF REGC,F
	GOTO $-.6
DECENA
	MOVLW .10
	SUBWF REGCONTADOR,F
	BTFSC STATUS,C
	GOTO $+.3
	ADDWF REGCONTADOR,F
	GOTO UNIDAD
	INCF REGD,F
	GOTO $-.6 
UNIDAD
	MOVLW .1
	SUBWF REGCONTADOR,F
	BTFSC STATUS,C
	GOTO $+.3
	ADDWF REGCONTADOR,F
	GOTO ALEATORIO
	INCF REGU,F
	GOTO $-.6

ALEATORIO
	MOVF REGU,W
	CALL TABLA1
	MOVWF REG1
	MOVWF PORTE
	CALL TIEMPO
	CLRF PORTE
	CALL TIEMPO

	MOVF REGU,W
	CALL TABLA2
	MOVWF REG2
	MOVWF PORTE
	CALL TIEMPO
	CLRF PORTE 
	CALL TIEMPO

	MOVF REGD,W
	CALL TABLA3
	MOVWF REG3
	MOVWF PORTE
	CALL TIEMPO
	CLRF PORTE
	CALL TIEMPO

	MOVF REGC,W
	CALL TABLA4
	MOVWF REG4
	MOVWF PORTE
	CALL TIEMPO
	CLRF PORTE
	CALL TIEMPO
INGRESOV1
	BTFSC PORTB,0 
	GOTO ROJO1
	BTFSC PORTB,1
	GOTO VERDE1
	BTFSC PORTB,2
	GOTO AZUL1
	GOTO INGRESOV1
INGRESOV2
	BTFSC PORTB,0 
	GOTO ROJO2
	BTFSC PORTB,1
	GOTO VERDE2
	BTFSC PORTB,2
	GOTO AZUL2
	GOTO INGRESOV2
INGRESOV3
	BTFSC PORTB,0 
	GOTO ROJO3
	BTFSC PORTB,1
	GOTO VERDE3
	BTFSC PORTB,2
	GOTO AZUL3
	GOTO INGRESOV3
INGRESOV4
	BTFSC PORTB,0 
	GOTO ROJO4
	BTFSC PORTB,1
	GOTO VERDE4
	BTFSC PORTB,2
	GOTO AZUL4
	GOTO INGRESOV4

ROJO1
    BTFSS PORTB,0
    GOTO $+.2
    MOVLW B'00000001'
    MOVWF PORTE
    MOVWF REG11
    CALL TIEMPO
    CLRF PORTE
    CALL TIEMPO
    GOTO INGRESOV2
VERDE1
    BTFSS PORTB,1
    GOTO $+.2
    MOVLW B'00000010'
    MOVWF PORTE
    MOVWF REG11
    CALL TIEMPO
    CLRF PORTE
    CALL TIEMPO
    GOTO INGRESOV2
AZUL1
    BTFSS PORTB,2
    GOTO $+.2
    MOVLW B'00000100'
    MOVWF PORTE
    MOVWF REG11
    CALL TIEMPO
    CLRF PORTE
    CALL TIEMPO
    GOTO INGRESOV2

ROJO2
    BTFSS PORTB,0
    GOTO $+.2
    MOVLW B'00000001'
    MOVWF PORTE
    MOVWF REG22
    CALL TIEMPO
    CLRF PORTE
    CALL TIEMPO
    GOTO INGRESOV3
VERDE2
    BTFSS PORTB,1
    GOTO $+.2
    MOVLW B'00000010'
    MOVWF PORTE
    MOVWF REG22
    CALL TIEMPO
    CLRF PORTE
    CALL TIEMPO
    GOTO INGRESOV3
AZUL2
    BTFSS PORTB,2
    GOTO $+.2
    MOVLW B'00000100'
    MOVWF PORTE
    MOVWF REG22
    CALL TIEMPO
    CLRF PORTE
    CALL TIEMPO
    GOTO INGRESOV3

ROJO3
    BTFSS PORTB,0
    GOTO $+.2
    MOVLW B'00000001'
    MOVWF PORTE
    MOVWF REG33
    CALL TIEMPO
    CLRF PORTE
    CALL TIEMPO
    GOTO INGRESOV4
VERDE3
    BTFSS PORTB,1
    GOTO $+.2
    MOVLW B'00000010'
    MOVWF PORTE
    MOVWF REG33
    CALL TIEMPO
    CLRF PORTE
    CALL TIEMPO
    GOTO INGRESOV4
AZUL3
    BTFSS PORTB,2
    GOTO $+.2
    MOVLW B'00000100'
    MOVWF PORTE
    MOVWF REG33
    CALL TIEMPO
    CLRF PORTE
    CALL TIEMPO
    GOTO INGRESOV4

ROJO4
    BTFSS PORTB,0
    GOTO $+.2
    MOVLW B'00000001'
    MOVWF PORTE
    MOVWF REG44
    CALL TIEMPO
    CLRF PORTE
    CALL TIEMPO
    GOTO COMPARO
VERDE4
    BTFSS PORTB,1
    GOTO $+.2
    MOVLW B'00000010'
    MOVWF PORTE
    MOVWF REG44
    CALL TIEMPO
    CLRF PORTE
    CALL TIEMPO
    GOTO COMPARO
AZUL4
    BTFSS PORTB,2
    GOTO $+.2
    MOVLW B'00000100'
    MOVWF PORTE
    MOVWF REG44
    CALL TIEMPO
    CLRF PORTE
    CALL TIEMPO
    GOTO COMPARO

COMPARO
	MOVF REG1,W
	XORWF REG11
	BTFSS STATUS,Z
	GOTO MAL
	MOVF REG2,W
	XORWF REG22
	BTFSS STATUS,Z
	GOTO MAL
	MOVF REG3,W
	XORWF REG33
	BTFSS STATUS,Z
	GOTO MAL
	MOVF REG4,W
	XORWF REG44
	BTFSS STATUS,Z
	GOTO MAL
	GOTO BIEN

MAL
	BSF PORTE,0
	CALL TIEMPO
	BCF PORTE,0
	CALL TIEMPO
	BSF PORTE,0
	CALL TIEMPO
	BCF PORTE,0
	CALL TIEMPO 
	GOTO INICIO

BIEN  
	BSF PORTE,1
	CALL TIEMPO
	BCF PORTE,1
	CALL TIEMPO
	BSF PORTE,1
	CALL TIEMPO
	BCF PORTE,1
	CALL TIEMPO 
	GOTO INICIO

TIEMPO
        movlw     .239      ; 1 set numero de repeticion  (B)
        movwf     PDel0     ; 1 |
PLoop1  movlw     .232      ; 1 set numero de repeticion  (A)
        movwf     PDel1     ; 1 |
PLoop2  clrwdt              ; 1 clear watchdog
PDelL1  goto PDelL2         ; 2 ciclos delay
PDelL2  goto PDelL3         ; 2 ciclos delay
PDelL3  clrwdt              ; 1 ciclo delay
        decfsz    PDel1, 1  ; 1 + (1) es el tiempo 0  ? (A)
        goto      PLoop2    ; 2 no, loop
        decfsz    PDel0,  1 ; 1 + (1) es el tiempo 0  ? (B)
        goto      PLoop1    ; 2 no, loop
PDelL4  goto PDelL5         ; 2 ciclos delay
PDelL5  goto PDelL6         ; 2 ciclos delay
PDelL6  goto PDelL7         ; 2 ciclos delay
PDelL7  clrwdt              ; 1 ciclo delay
        return              ; 2+2 Fin.
	END